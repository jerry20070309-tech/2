<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>âš¡ SNIPER V12.4 | TOTAL RECOVERY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #050505; color: #FFD700; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        
        /* æ ¸å¿ƒå¡ç‰‡æ¨£å¼ - åš´æ ¼å°é½Šåœ–ç‰‡ */
        .card { background: #081221; border: 1px solid #1e335a; transition: 0.2s; position: relative; cursor: pointer; border-radius: 12px; }
        .hunt-card { border: 2px solid #ff0000; background: #2a0000 !important; box-shadow: 0 0 20px rgba(255, 0, 0, 0.4); animation: blink 0.8s infinite; }
        .entry-ready { border: 2px solid #22c55e !important; box-shadow: 0 0 15px rgba(34, 197, 94, 0.4); }
        .pinned { border: 2px solid #3b82f6 !important; background: #0a1a35 !important; }

        /* é ‚éƒ¨æ¨™ç±¤ */
        .tag-group { display: flex; gap: 4px; }
        .tag-vld { background: #1a1a1a; color: #444; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 800; }
        .tag-vld.active { background: #22c55e; color: #000; }
        .tag-pattern { border: 1px solid #FFD700; color: #FFD700; padding: 1px 6px; border-radius: 4px; font-size: 10px; font-weight: 800; }

        /* ç­‰å¾…å€é–“ */
        .waiting-box { border: 1px dashed #222; color: #444; background: rgba(0,0,0,0.3); margin: 12px 0; padding: 6px 0; text-align: center; font-weight: 800; border-radius: 8px; }

        /* æ•¸æ“šæ¡† */
        .data-grid { display: grid; grid-cols: 2; gap: 8px; margin-bottom: 12px; }
        .data-item { background: #000; border: 1px solid #111; padding: 6px; border-radius: 4px; font-size: 10px; font-weight: 800; }

        /* åº•éƒ¨æŒ‡ç¤ºç‡ˆèˆ‡ TSL */
        .status-row { border-top: 1px solid #111; pt: 8px; display: flex; justify-content: space-between; align-items: center; }
        .led-group { display: flex; gap: 8px; font-size: 11px; font-weight: 900; color: #222; }
        .led-group span.active { color: #22c55e; }
        .tsl-mode { background: #7f1d1d; color: #f87171; padding: 1px 8px; border-radius: 999px; font-size: 9px; font-weight: 900; }
        
        .price-row { display: flex; justify-content: space-between; font-size: 10px; font-weight: 800; font-style: italic; margin-top: 4px; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
    </style>
</head>
<body class="h-screen flex flex-col">

    <header class="p-3 border-b border-yellow-900 bg-black flex justify-between items-center shrink-0">
        <div class="flex items-center gap-4">
            <h1 class="text-2xl font-black text-yellow-500 italic">âš¡ SNIPER V12.4</h1>
            <div class="flex gap-2 bg-zinc-900 p-1 rounded border border-zinc-700">
                <input id="searchInput" type="text" placeholder="æœå°‹å¹£å" class="bg-transparent text-xs px-2 focus:outline-none w-24 text-white uppercase">
                <button onclick="manualAdd()" class="bg-yellow-600 text-black px-2 py-0.5 font-bold rounded text-[10px]">ADD</button>
            </div>
            <div class="flex gap-2 ml-4">
                <button onclick="applyPreset('Ambush')" class="bg-zinc-800 border border-zinc-700 px-3 py-1 rounded text-[10px] text-blue-400 font-bold hover:border-blue-500">é€±æœ«åŸ‹ä¼</button>
                <button onclick="applyPreset('Hunt')" class="bg-zinc-800 border border-zinc-700 px-3 py-1 rounded text-[10px] text-red-400 font-bold hover:border-red-500">å¼·å‹¢çµæ®º</button>
                <button onclick="applyPreset('Spike')" class="bg-zinc-800 border border-zinc-700 px-3 py-1 rounded text-[10px] text-purple-400 font-bold hover:border-purple-500">ç•°å‹•ç›£æ§</button>
            </div>
        </div>
        <div class="flex gap-4 items-center">
            <div id="klineStatus" class="bg-zinc-900 px-3 py-1 rounded text-white border border-zinc-800 text-[10px]">ç­‰å¾…åŒæ­¥...</div>
            <button id="sysBtn" onclick="toggleSystem()" class="bg-blue-600 text-white px-6 py-1 rounded font-black text-[10px]">START RADAR</button>
        </div>
    </header>

    <div class="bg-zinc-950 p-3 border-b border-yellow-900/30 grid grid-cols-5 gap-6 uppercase font-bold text-zinc-500">
        <div class="space-y-1">
            <div class="flex justify-between text-yellow-500"><span>ğŸŒ€ SQZ</span><span id="v_sqz">1.2%</span></div>
            <input type="range" id="i_sqz" min="5" max="50" value="12" class="w-full accent-yellow-500">
        </div>
        <div class="space-y-1">
            <div class="flex justify-between text-green-500"><span>ğŸ¯ POC</span><span id="v_poc">1.1%</span></div>
            <input type="range" id="i_poc" min="1" max="100" value="11" class="w-full accent-green-500">
        </div>
        <div class="space-y-1">
            <div class="flex justify-between text-red-500"><span>ğŸš¨ SLP</span><span id="v_slp">-0.5%</span></div>
            <input type="range" id="i_slp" min="1" max="100" value="50" class="w-full accent-red-500">
        </div>
        <div class="space-y-1">
            <div class="flex justify-between text-blue-500"><span>ğŸš€ DRV</span><span id="v_drv">90</span></div>
            <input type="range" id="i_drv" min="10" max="150" value="90" class="w-full accent-blue-500">
        </div>
        <div class="space-y-1">
            <div class="flex justify-between text-orange-500"><span>âš¡ MOM</span><span id="v_mom">0.8%</span></div>
            <input type="range" id="i_mom" min="1" max="50" value="8" class="w-full accent-orange-500">
        </div>
    </div>

    <div class="flex flex-1 overflow-hidden">
        <main class="flex-1 p-4 overflow-y-auto bg-black">
            <div id="dashboard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
        </main>
        <aside class="w-80 border-l border-yellow-900 bg-black flex flex-col shrink-0">
            <div class="p-3 border-b border-zinc-900 text-red-600 font-black flex justify-between items-center">
                <span>æˆ°é¬¥æ—¥èªŒ (V12.4 FULL)</span>
                <span id="timerDisplay" class="text-zinc-800 text-[9px]">OFFLINE</span>
            </div>
            <div id="logContainer" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
        </aside>
    </div>

<script>
    let stats = {}, pinned = new Set(), isRunning = false;
    let coinHistory = {}, priceSnapshots = {}, signalCount = {}, lastSnapMin = -1;
    let FILTER = { SQZ: 0.012, POC: 0.011, SLP: -0.005, DRV: 90, MOM: 0.008 };

    // å¿«æ·ç´é‚è¼¯ - ä¿®æ­£ç‚ºé€±å…­/é€±ä¸€é«˜å‹ç‡æ–¹æ³•
    function applyPreset(type) {
        const p = {
            'Ambush': { sqz:8, poc:5, slp:10, drv:110, mom:5 },
            'Hunt': { sqz:15, poc:12, slp:25, drv:85, mom:12 },
            'Spike': { sqz:25, poc:20, slp:40, drv:60, mom:25 }
        }[type];
        document.getElementById('i_sqz').value = p.sqz;
        document.getElementById('i_poc').value = p.poc;
        document.getElementById('i_slp').value = p.slp;
        document.getElementById('i_drv').value = p.drv;
        document.getElementById('i_mom').value = p.mom;
        document.querySelectorAll('input[type=range]').forEach(i => i.dispatchEvent(new Event('input')));
    }

    // æ»‘å‹•æ¢é€£å‹•
    document.querySelectorAll('input[type=range]').forEach(input => {
        input.oninput = (e) => {
            const id = e.target.id;
            const val = parseFloat(e.target.value);
            if(id==='i_sqz') FILTER.SQZ = val/1000;
            if(id==='i_poc') FILTER.POC = val/1000;
            if(id==='i_slp') FILTER.SLP = -(val/10000);
            if(id==='i_drv') FILTER.DRV = val;
            if(id==='i_mom') FILTER.MOM = val/1000;
            // æ›´æ–°æ•¸å€¼é¡¯ç¤º...
            render();
        };
    });

    async function scan() {
        if(!isRunning) return;
        try {
            const [tRes, pRes] = await Promise.all([
                fetch('https://fapi.binance.com/fapi/v1/ticker/24hr'),
                fetch('https://fapi.binance.com/fapi/v1/premiumIndex')
            ]);
            const tickers = await tRes.json();
            const premiumMap = Object.fromEntries((await pRes.json()).map(p => [p.symbol, p]));

            tickers.forEach(t => {
                const s = t.symbol; if (!s.endsWith('USDT')) return;
                const price = parseFloat(t.lastPrice), avg = parseFloat(t.weightedAvgPrice);
                const fund = parseFloat(premiumMap[s]?.lastFundingRate || 0);
                
                // SLP è¨ˆç®—
                if(!coinHistory[s]) coinHistory[s] = [];
                coinHistory[s].push(fund);
                if(coinHistory[s].length > 20) coinHistory[s].shift();
                const slope = coinHistory[s].length >= 20 ? (fund - coinHistory[s][0]) : 0;

                const maSqz = (parseFloat(t.highPrice) - parseFloat(t.lowPrice)) / avg;
                const drv = Math.min(100, (Math.abs(parseFloat(t.priceChangePercent)) / (parseFloat(t.quoteVolume)/1e8)) * 15);
                
                // M7_VLD åˆ¤å®š
                if(!signalCount[s]) signalCount[s] = 0;
                if(price > avg * 1.002) signalCount[s]++; else signalCount[s] = 0;

                stats[s] = {
                    s, price, fund, maSqz, drv, slope,
                    isAboveM7: signalCount[s] >= 3,
                    isTight: Math.abs(price - avg)/avg < 0.003,
                    isPoc: Math.abs(parseFloat(t.priceChangePercent))/100 >= FILTER.POC,
                    score: Math.floor(drv/3 + (signalCount[s]>=3?30:0)),
                    tsl: avg * 0.995, ttp: price * 1.05
                };
            });
            render();
        } catch(e) {}
        setTimeout(scan, 3000);
    }

    function render() {
        const db = document.getElementById('dashboard');
        db.innerHTML = Object.values(stats).sort((a,b)=>b.score - a.score).slice(0,24).map(x => `
            <div class="card p-4 ${x.score >= 80 ? 'hunt-card' : ''}">
                <div class="flex justify-between items-start">
                    <div class="tag-group">
                        <span class="tag-vld ${x.isAboveM7?'active':''}">M7_VLD</span>
                        <span class="tag-vld ${x.isTight?'active':''}">TIGHT</span>
                        ${x.drv > 95 ? '<span class="tag-pattern">ğŸš€çœŸç©ºå™´ç™¼</span>' : ''}
                    </div>
                    <span class="text-xs font-black text-yellow-500">SCORE: ${x.score}</span>
                </div>
                <div class="flex justify-between items-end my-2">
                    <h2 class="text-3xl font-black text-white">${x.s.replace('USDT','')}</h2>
                    <div class="text-right leading-none">
                        <div class="text-red-600 font-bold">${(x.fund*100).toFixed(4)}%</div>
                        <div class="text-zinc-500">$${x.price.toFixed(4)}</div>
                    </div>
                </div>
                <div class="waiting-box">âŒ› WAITING FOR PULLBACK</div>
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <div class="data-item text-zinc-400">SQZ: ${(x.maSqz*100).toFixed(2)}%</div>
                    <div class="data-item text-right text-blue-500">DRV: ${x.drv.toFixed(0)}</div>
                </div>
                <div class="status-row">
                    <div class="led-group">
                        <span class="${x.slope <= FILTER.SLP ? 'active':''}">SLP</span>
                        <span class="${x.maSqz <= FILTER.SQZ ? 'active':''}">SQZ</span>
                        <span class="${x.isPoc ? 'active':''}">POC</span>
                    </div>
                    <span class="tsl-mode">M7_TIGHT</span>
                </div>
                <div class="price-row">
                    <span class="text-zinc-600">SL_TRAIL: $${x.tsl.toFixed(4)}</span>
                    <span class="text-green-500">TP_TRAIL: $${x.ttp.toFixed(4)}</span>
                </div>
            </div>
        `).join('');
    }

    function toggleSystem() { isRunning = !isRunning; if(isRunning) scan(); }
    function manualAdd() { /* é‚è¼¯ä¿æŒä¸è®Š */ }
</script>
</body>
</html>
